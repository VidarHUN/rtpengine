version: "2"

services:
  redis:
    image: redis:5.0.5

  data:
    image: redis:5.0.5
    depends_on:
      - redis
    command: |
      redis-cli -h redis set 123 "{\"json\":{\"created\":\"1579622392019642\",\"last_signal\":\"1579622392\",\"tos\":\"0\",\"deleted\":\"0\",\"num_sfds\":\"8\",\"num_streams\":\"4\",\"num_medias\":\"2\",\"num_tags\":\"2\",\"num_maps\":\"2\",\"ml_deleted\":\"0\",\"created_from\":\"52.14.178.229:44685\",\"created_from_addr\":\"52.14.178.229\",\"redis_hosted_db\":\"1\",\"recording_metadata\":\"\",\"block_dtmf\":\"0\",\"block_media\":\"0\"},\"sfd-0\":{\"pref_family\":\"IP4\",\"localport\":\"30000\",\"logical_intf\":\"default\",\"local_intf_uid\":\"0\",\"stream\":\"0\"},\"sfd-1\":{\"pref_family\":\"IP4\",\"localport\":\"30001\",\"logical_intf\":\"default\",\"local_intf_uid\":\"0\",\"stream\":\"1\"},\"sfd-2\":{\"pref_family\":\"IP4\",\"localport\":\"30000\",\"logical_intf\":\"default\",\"local_intf_uid\":\"1\",\"stream\":\"0\"},\"sfd-3\":{\"pref_family\":\"IP4\",\"localport\":\"30001\",\"logical_intf\":\"default\",\"local_intf_uid\":\"1\",\"stream\":\"1\"},\"sfd-4\":{\"pref_family\":\"IP4\",\"localport\":\"30012\",\"logical_intf\":\"default\",\"local_intf_uid\":\"0\",\"stream\":\"2\"},\"sfd-5\":{\"pref_family\":\"IP4\",\"localport\":\"30013\",\"logical_intf\":\"default\",\"local_intf_uid\":\"0\",\"stream\":\"3\"},\"sfd-6\":{\"pref_family\":\"IP4\",\"localport\":\"30020\",\"logical_intf\":\"default\",\"local_intf_uid\":\"1\",\"stream\":\"2\"},\"sfd-7\":{\"pref_family\":\"IP4\",\"localport\":\"30021\",\"logical_intf\":\"default\",\"local_intf_uid\":\"1\",\"stream\":\"3\"},\"stream-0\":{\"media\":\"0\",\"sfd\":\"0\",\"rtp_sink\":\"2\",\"rtcp_sink\":\"2\",\"rtcp_sibling\":\"1\",\"last_packet\":\"1579622392\",\"ps_flags\":\"196608\",\"component\":\"1\",\"endpoint\":\"\",\"advertised_endpoint\":\"\",\"stats-packets\":\"0\",\"stats-bytes\":\"0\",\"stats-errors\":\"0\"},\"stream-1\":{\"media\":\"0\",\"sfd\":\"1\",\"rtp_sink\":\"4294967295\",\"rtcp_sink\":\"2\",\"rtcp_sibling\":\"4294967295\",\"last_packet\":\"1579622392\",\"ps_flags\":\"393216\",\"component\":\"2\",\"endpoint\":\"\",\"advertised_endpoint\":\"\",\"stats-packets\":\"0\",\"stats-bytes\":\"0\",\"stats-errors\":\"0\"},\"stream-2\":{\"media\":\"1\",\"sfd\":\"4\",\"rtp_sink\":\"0\",\"rtcp_sink\":\"0\",\"rtcp_sibling\":\"3\",\"last_packet\":\"1579622392\",\"ps_flags\":\"1245696\",\"component\":\"1\",\"endpoint\":\"62.0.130.253:40100\",\"advertised_endpoint\":\"62.0.130.253:40100\",\"stats-packets\":\"0\",\"stats-bytes\":\"0\",\"stats-errors\":\"0\"},\"stream-3\":{\"media\":\"1\",\"sfd\":\"5\",\"rtp_sink\":\"4294967295\",\"rtcp_sink\":\"0\",\"rtcp_sibling\":\"4294967295\",\"last_packet\":\"1579622392\",\"ps_flags\":\"1442304\",\"component\":\"2\",\"endpoint\":\"\",\"advertised_endpoint\":\"\",\"stats-packets\":\"0\",\"stats-bytes\":\"0\",\"stats-errors\":\"0\"},\"stream_sfds-0\":[\"0\",\"2\"],\"stream_sfds-1\":[\"1\",\"3\"],\"stream_sfds-2\":[\"4\",\"6\"],\"stream_sfds-3\":[\"5\",\"7\"],\"tag-0\":{\"created\":\"1579622392\",\"active\":\"1\",\"deleted\":\"0\",\"block_dtmf\":\"0\",\"block_media\":\"0\",\"tag\":\"1367523056\"},\"tag-1\":{\"created\":\"1579622392\",\"active\":\"0\",\"deleted\":\"0\",\"block_dtmf\":\"0\",\"block_media\":\"0\"},\"other_tags-0\":[],\"medias-0\":[\"1\"],\"other_tags-1\":[],\"medias-1\":[\"0\"],\"media-0\":{\"tag\":\"1\",\"index\":\"1\",\"type\":\"audio\",\"protocol\":\"RTP/AVP\",\"desired_family\":\"IP4\",\"logical_intf\":\"default\",\"ptime\":\"0\",\"media_flags\":\"10485788\",\"rtpe_addr\":\"IP4 3.8.44.129\"},\"media-1\":{\"tag\":\"0\",\"index\":\"1\",\"type\":\"audio\",\"protocol\":\"RTP/AVP\",\"desired_family\":\"IP4\",\"logical_intf\":\"default\",\"ptime\":\"0\",\"media_flags\":\"65564\",\"rtpe_addr\":\"IP4 3.8.44.129\"},\"streams-0\":[\"0\",\"1\"],\"maps-0\":[\"0\"],\"payload_types-0\":[\"101/telephone-event/8000//0-15/0/-1\",\"9/G722/8000///0/20\"],\"payload_types_send-0\":[],\"streams-1\":[\"2\",\"3\"],\"maps-1\":[\"1\"],\"payload_types-1\":[],\"payload_types_send-1\":[\"97/OPUS/48000/2/useinbandfec=1;maxplaybackrate=16000;usedtx=1/0/20\",\"3/GSM/8000///0/20\",\"0/PCMU/8000///0/20\",\"8/PCMA/8000///0/20\",\"101/telephone-event/8000//0-15/0/-1\"],\"map-0\":{\"wildcard\":\"0\",\"num_ports\":\"2\",\"intf_preferred_family\":\"IP4\",\"logical_intf\":\"default\",\"endpoint\":\"62.0.130.253:40100\"},\"map-1\":{\"wildcard\":\"-1\",\"num_ports\":\"2\",\"intf_preferred_family\":\"IP4\",\"logical_intf\":\"default\",\"endpoint\":\"\"},\"map_sfds-0\":[\"loc-0\",\"0\",\"1\",\"loc-1\",\"2\",\"3\"],\"map_sfds-1\":[\"loc-0\",\"4\",\"5\",\"loc-1\",\"6\",\"7\"],\"ssrc_table\":[]}"

  rtpengine:
    build: .
    volumes:
      - ./test.conf:/etc/rtpengine/rtpengine.conf
    command: rtpengine -f -E --no-log-timestamps --pidfile /run/ngcp-rtpengine-daemon.pid --config-file /etc/rtpengine/rtpengine.conf --listen-cli=9900
